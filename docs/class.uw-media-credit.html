<!DOCTYPE html>

<html>
<head>
  <title>class.uw-media-credit.php</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="404.html">
                404.php
              </a>
            
              
              <a class="source" href="application.html">
                application.php
              </a>
            
              
              <a class="source" href="archive.html">
                archive.php
              </a>
            
              
              <a class="source" href="breadcrumbs.html">
                breadcrumbs.php
              </a>
            
              
              <a class="source" href="comments.html">
                comments.php
              </a>
            
              
              <a class="source" href="content-archive.html">
                content-archive.php
              </a>
            
              
              <a class="source" href="content-image.html">
                content-image.php
              </a>
            
              
              <a class="source" href="content-page.html">
                content-page.php
              </a>
            
              
              <a class="source" href="content-pdf.html">
                content-pdf.php
              </a>
            
              
              <a class="source" href="content.html">
                content.php
              </a>
            
              
              <a class="source" href="footer.html">
                footer.php
              </a>
            
              
              <a class="source" href="functions.html">
                functions.php
              </a>
            
              
              <a class="source" href="header-image.html">
                header-image.php
              </a>
            
              
              <a class="source" href="header.html">
                header.php
              </a>
            
              
              <a class="source" href="image.html">
                image.php
              </a>
            
              
              <a class="source" href="template-functions.html">
                template-functions.php
              </a>
            
              
              <a class="source" href="index.html">
                index.php
              </a>
            
              
              <a class="source" href="uw.html">
                uw.js
              </a>
            
              
              <a class="source" href="menu-mobile.html">
                menu-mobile.php
              </a>
            
              
              <a class="source" href="page.html">
                page.php
              </a>
            
              
              <a class="source" href="search.html">
                search.php
              </a>
            
              
              <a class="source" href="searchform.html">
                searchform.php
              </a>
            
              
              <a class="source" href="class.button-shortcode.html">
                class.button-shortcode.php
              </a>
            
              
              <a class="source" href="class.dropdowns_walker.html">
                class.dropdowns_walker.php
              </a>
            
              
              <a class="source" href="class.filters.html">
                class.filters.php
              </a>
            
              
              <a class="source" href="class.googleapps.html">
                class.googleapps.php
              </a>
            
              
              <a class="source" href="class.images.html">
                class.images.php
              </a>
            
              
              <a class="source" href="class.install.html">
                class.install.php
              </a>
            
              
              <a class="source" href="class.mimes.html">
                class.mimes.php
              </a>
            
              
              <a class="source" href="class.squish_bugs.html">
                class.squish_bugs.php
              </a>
            
              
              <a class="source" href="class.tile-box-shortcode.html">
                class.tile-box-shortcode.php
              </a>
            
              
              <a class="source" href="class.trumba-shortcode.html">
                class.trumba-shortcode.php
              </a>
            
              
              <a class="source" href="class.users.html">
                class.users.php
              </a>
            
              
              <a class="source" href="class.uw-carousel.html">
                class.uw-carousel.php
              </a>
            
              
              <a class="source" href="class.uw-directory.html">
                class.uw-directory.php
              </a>
            
              
              <a class="source" href="class.uw-documentation.html">
                class.uw-documentation.php
              </a>
            
              
              <a class="source" href="class.uw-dropdowns.html">
                class.uw-dropdowns.php
              </a>
            
              
              <a class="source" href="class.uw-enclosure.html">
                class.uw-enclosure.php
              </a>
            
              
              <a class="source" href="class.uw-iframes.html">
                class.uw-iframes.php
              </a>
            
              
              <a class="source" href="class.uw-media-caption.html">
                class.uw-media-caption.php
              </a>
            
              
              <a class="source" href="class.uw-media-credit.html">
                class.uw-media-credit.php
              </a>
            
              
              <a class="source" href="class.uw-oembeds.html">
                class.uw-oembeds.php
              </a>
            
              
              <a class="source" href="class.uw-page-attributes-meta-box.html">
                class.uw-page-attributes-meta-box.php
              </a>
            
              
              <a class="source" href="class.uw-quicklinks.html">
                class.uw-quicklinks.php
              </a>
            
              
              <a class="source" href="class.uw-replace-media.html">
                class.uw-replace-media.php
              </a>
            
              
              <a class="source" href="class.uw-scripts.html">
                class.uw-scripts.php
              </a>
            
              
              <a class="source" href="class.uw-shortcodes.html">
                class.uw-shortcodes.php
              </a>
            
              
              <a class="source" href="class.uw-styles.html">
                class.uw-styles.php
              </a>
            
              
              <a class="source" href="class.uw-tinymce.html">
                class.uw-tinymce.php
              </a>
            
              
              <a class="source" href="class.uw.html">
                class.uw.php
              </a>
            
              
              <a class="source" href="class.youtube-shortcode.html">
                class.youtube-shortcode.php
              </a>
            
              
              <a class="source" href="sidebar.html">
                sidebar.php
              </a>
            
              
              <a class="source" href="template-big-hero.html">
                template-big-hero.php
              </a>
            
              
              <a class="source" href="template-no-hero.html">
                template-no-hero.php
              </a>
            
              
              <a class="source" href="template-no-sidebar.html">
                template-no-sidebar.php
              </a>
            
              
              <a class="source" href="template-no-title.html">
                template-no-title.php
              </a>
            
              
              <a class="source" href="template-small-hero.html">
                template-small-hero.php
              </a>
            
              
              <a class="source" href="thinstrip.html">
                thinstrip.php
              </a>
            
              
              <a class="source" href="class.uw-blogroll.html">
                class.uw-blogroll.php
              </a>
            
              
              <a class="source" href="class.uw-campus-map.html">
                class.uw-campus-map.php
              </a>
            
              
              <a class="source" href="class.uw-intro.html">
                class.uw-intro.php
              </a>
            
              
              <a class="source" href="class.uw-recent-posts.html">
                class.uw-recent-posts.php
              </a>
            
              
              <a class="source" href="class.uw-related-posts.html">
                class.uw-related-posts.php
              </a>
            
              
              <a class="source" href="class.uw-rss.html">
                class.uw-rss.php
              </a>
            
              
              <a class="source" href="class.uw-sidebar.html">
                class.uw-sidebar.php
              </a>
            
              
              <a class="source" href="class.uw-single-image.html">
                class.uw-single-image.php
              </a>
            
              
              <a class="source" href="class.uw-top-posts.html">
                class.uw-top-posts.php
              </a>
            
              
              <a class="source" href="class.uw-twitter.html">
                class.uw-twitter.php
              </a>
            
              
              <a class="source" href="class.uw-widget-visibility.html">
                class.uw-widget-visibility.php
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>class.uw-media-credit.php</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-comment">/**
 * Adds a media credit to images in the media library
 */</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UW_Media_Credit</span>
</span>{

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">UW_Media_Credit</span><span class="hljs-params">()</span>
  </span>{

	add_filter( <span class="hljs-string">'mce_external_plugins'</span>, <span class="hljs-keyword">array</span>( <span class="hljs-variable">$this</span>, <span class="hljs-string">'add_media_credit_shortcode_to_tinymce'</span> ) );

    add_filter( <span class="hljs-string">'image_send_to_editor'</span>, <span class="hljs-keyword">array</span>( <span class="hljs-variable">$this</span>, <span class="hljs-string">'mediacredit_tinymce_html'</span>), <span class="hljs-number">10</span>, <span class="hljs-number">7</span> );
    add_shortcode( <span class="hljs-string">'mediacredit'</span>, <span class="hljs-keyword">array</span>( <span class="hljs-variable">$this</span>, <span class="hljs-string">'mediacredit_html'</span> ) );

    add_filter( <span class="hljs-string">"attachment_fields_to_edit"</span>, <span class="hljs-keyword">array</span>( <span class="hljs-variable">$this</span>, <span class="hljs-string">"image_attachment_fields_to_edit"</span>), <span class="hljs-number">100</span>, <span class="hljs-number">2</span>);
    add_filter( <span class="hljs-string">"attachment_fields_to_save"</span>, <span class="hljs-keyword">array</span>( <span class="hljs-variable">$this</span>, <span class="hljs-string">"custom_image_attachment_fields_to_save"</span> ), <span class="hljs-keyword">null</span>, <span class="hljs-number">2</span>);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add_media_credit_shortcode_to_tinymce</span><span class="hljs-params">( <span class="hljs-variable">$plugins</span> )</span>
  </span>{
     <span class="hljs-variable">$plugin_array</span>[ <span class="hljs-string">'mediacredit'</span> ] = get_template_directory_uri() . <span class="hljs-string">'/assets/admin/js/media-credit.js'</span>;
     <span class="hljs-keyword">return</span> <span class="hljs-variable">$plugin_array</span>;
  }

  <span class="hljs-comment">/**
   * Override the editor html to include media credit even if the photo caption is empty
   */</span>

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mediacredit_tinymce_html</span><span class="hljs-params">( <span class="hljs-variable">$html</span>, <span class="hljs-variable">$id</span>, <span class="hljs-variable">$caption</span>, <span class="hljs-variable">$title</span>, <span class="hljs-variable">$align</span>, <span class="hljs-variable">$url</span>, <span class="hljs-variable">$size</span> )</span>
  </span>{
    <span class="hljs-keyword">if</span> ( <span class="hljs-variable">$caption</span> )
      <span class="hljs-keyword">return</span> <span class="hljs-variable">$html</span>;

    <span class="hljs-variable">$credit</span> = get_post_meta( <span class="hljs-variable">$id</span>, <span class="hljs-string">'_media_credit'</span>, <span class="hljs-keyword">true</span>);
    <span class="hljs-variable">$img</span>    = wp_get_attachment_image_src( <span class="hljs-variable">$id</span>, <span class="hljs-variable">$size</span> );

    <span class="hljs-keyword">return</span> <span class="hljs-variable">$credit</span> ?
      <span class="hljs-string">"&lt;dl class='mediacredit align$align' data-credit='$credit' data-align='align$align' data-size='$size' style='width:{$img[1]}px'&gt;
        &lt;dt class='mediacredit-dt'&gt;$html&lt;/dt&gt;
        &lt;dd class='wp-caption-dd'&gt;$credit&lt;/dd&gt;
      &lt;/dl&gt;"</span> : <span class="hljs-variable">$html</span>;
  }

  <span class="hljs-comment">/**
   *
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mediacredit_html</span><span class="hljs-params">( <span class="hljs-variable">$attrs</span>, <span class="hljs-variable">$content</span> )</span>
  </span>{
    extract(shortcode_atts(<span class="hljs-keyword">array</span>(
      <span class="hljs-string">'id'</span>	=&gt; <span class="hljs-string">''</span>,
      <span class="hljs-string">'align'</span>	=&gt; <span class="hljs-string">''</span>,
      <span class="hljs-string">'size'</span>	=&gt; <span class="hljs-string">''</span>,
      <span class="hljs-string">'credit'</span>	=&gt; <span class="hljs-string">''</span>,
    ), <span class="hljs-variable">$attrs</span>));

    <span class="hljs-variable">$img</span>    = wp_get_attachment_image_src( <span class="hljs-variable">$id</span>, <span class="hljs-variable">$size</span> );
    <span class="hljs-variable">$width</span>  = <span class="hljs-variable">$img</span>[<span class="hljs-number">1</span>];

    <span class="hljs-keyword">if</span> ( <span class="hljs-number">1</span> &gt; (int) <span class="hljs-variable">$id</span> )
      <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;div class="wp-caption '</span> . esc_attr(<span class="hljs-variable">$align</span>) . <span class="hljs-string">'" style="width:'</span>. ( <span class="hljs-number">10</span>  + (int) <span class="hljs-variable">$width</span> ) .<span class="hljs-string">'px"&gt;'</span> .
      do_shortcode( <span class="hljs-variable">$content</span> ) . <span class="hljs-string">'&lt;p class="wp-media-credit"&gt;'</span>.<span class="hljs-variable">$credit</span>.<span class="hljs-string">'&lt;/p&gt;'</span> . <span class="hljs-string">'&lt;/div&gt;'</span>;
  }

  <span class="hljs-comment">/**
   * Adding the custom fields to the $form_fields array
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">image_attachment_fields_to_edit</span><span class="hljs-params">(<span class="hljs-variable">$form_fields</span>, <span class="hljs-variable">$post</span>)</span>
  </span>{
    <span class="hljs-keyword">if</span> ( ! in_array( <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'context'</span>],
      <span class="hljs-keyword">array</span>( <span class="hljs-string">'custom-header-blogroll-banner'</span>, <span class="hljs-string">'custom-header'</span> ) ) &amp;&amp;
        wp_attachment_is_image( <span class="hljs-variable">$post</span><span class="hljs-variable">-&gt;ID</span> ) )
    {
      <span class="hljs-variable">$form_fields</span>[<span class="hljs-string">"media_credit"</span>] = <span class="hljs-keyword">array</span>(
        <span class="hljs-string">"label"</span> =&gt; __(<span class="hljs-string">"Image Credit"</span>),
        <span class="hljs-string">"input"</span> =&gt; <span class="hljs-string">"text"</span>,
        <span class="hljs-string">"value"</span> =&gt; get_post_meta(<span class="hljs-variable">$post</span><span class="hljs-variable">-&gt;ID</span>, <span class="hljs-string">"_media_credit"</span>, <span class="hljs-keyword">true</span>)
      );

      <span class="hljs-variable">$form_fields</span>[<span class="hljs-string">"media_credit"</span>][<span class="hljs-string">"label"</span>] = __( <span class="hljs-string">"Image Credit"</span> );
      <span class="hljs-variable">$form_fields</span>[<span class="hljs-string">"media_credit"</span>][<span class="hljs-string">"input"</span>] = <span class="hljs-string">"text"</span>;
      <span class="hljs-variable">$form_fields</span>[<span class="hljs-string">"media_credit"</span>][<span class="hljs-string">"value"</span>] = get_post_meta( <span class="hljs-variable">$post</span><span class="hljs-variable">-&gt;ID</span>, <span class="hljs-string">"_media_credit"</span>, <span class="hljs-keyword">true</span> );
    }

    <span class="hljs-keyword">return</span> <span class="hljs-variable">$form_fields</span>;
  }

  <span class="hljs-comment">/**
   * Save the media credit
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">custom_image_attachment_fields_to_save</span><span class="hljs-params">(<span class="hljs-variable">$post</span>, <span class="hljs-variable">$attachment</span>)</span> </span>{
    <span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$attachment</span>[<span class="hljs-string">'media_credit'</span>] ) )
    {
      update_post_meta(<span class="hljs-variable">$post</span>[<span class="hljs-string">'ID'</span>], <span class="hljs-string">'_media_credit'</span>, <span class="hljs-variable">$attachment</span>[<span class="hljs-string">'media_credit'</span>]);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$post</span>;
  }

}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
