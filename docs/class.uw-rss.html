<!DOCTYPE html>

<html>
<head>
  <title>class.uw-rss.php</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="404.html">
                404.php
              </a>
            
              
              <a class="source" href="application.html">
                application.php
              </a>
            
              
              <a class="source" href="archive.html">
                archive.php
              </a>
            
              
              <a class="source" href="breadcrumbs.html">
                breadcrumbs.php
              </a>
            
              
              <a class="source" href="comments.html">
                comments.php
              </a>
            
              
              <a class="source" href="content-archive.html">
                content-archive.php
              </a>
            
              
              <a class="source" href="content-image.html">
                content-image.php
              </a>
            
              
              <a class="source" href="content-page.html">
                content-page.php
              </a>
            
              
              <a class="source" href="content-pdf.html">
                content-pdf.php
              </a>
            
              
              <a class="source" href="content.html">
                content.php
              </a>
            
              
              <a class="source" href="footer.html">
                footer.php
              </a>
            
              
              <a class="source" href="functions.html">
                functions.php
              </a>
            
              
              <a class="source" href="header-image.html">
                header-image.php
              </a>
            
              
              <a class="source" href="header.html">
                header.php
              </a>
            
              
              <a class="source" href="image.html">
                image.php
              </a>
            
              
              <a class="source" href="template-functions.html">
                template-functions.php
              </a>
            
              
              <a class="source" href="index.html">
                index.php
              </a>
            
              
              <a class="source" href="uw.html">
                uw.js
              </a>
            
              
              <a class="source" href="menu-mobile.html">
                menu-mobile.php
              </a>
            
              
              <a class="source" href="page.html">
                page.php
              </a>
            
              
              <a class="source" href="search.html">
                search.php
              </a>
            
              
              <a class="source" href="searchform.html">
                searchform.php
              </a>
            
              
              <a class="source" href="class.button-shortcode.html">
                class.button-shortcode.php
              </a>
            
              
              <a class="source" href="class.dropdowns_walker.html">
                class.dropdowns_walker.php
              </a>
            
              
              <a class="source" href="class.filters.html">
                class.filters.php
              </a>
            
              
              <a class="source" href="class.googleapps.html">
                class.googleapps.php
              </a>
            
              
              <a class="source" href="class.images.html">
                class.images.php
              </a>
            
              
              <a class="source" href="class.install.html">
                class.install.php
              </a>
            
              
              <a class="source" href="class.mimes.html">
                class.mimes.php
              </a>
            
              
              <a class="source" href="class.squish_bugs.html">
                class.squish_bugs.php
              </a>
            
              
              <a class="source" href="class.tile-box-shortcode.html">
                class.tile-box-shortcode.php
              </a>
            
              
              <a class="source" href="class.trumba-shortcode.html">
                class.trumba-shortcode.php
              </a>
            
              
              <a class="source" href="class.users.html">
                class.users.php
              </a>
            
              
              <a class="source" href="class.uw-carousel.html">
                class.uw-carousel.php
              </a>
            
              
              <a class="source" href="class.uw-directory.html">
                class.uw-directory.php
              </a>
            
              
              <a class="source" href="class.uw-documentation.html">
                class.uw-documentation.php
              </a>
            
              
              <a class="source" href="class.uw-dropdowns.html">
                class.uw-dropdowns.php
              </a>
            
              
              <a class="source" href="class.uw-enclosure.html">
                class.uw-enclosure.php
              </a>
            
              
              <a class="source" href="class.uw-iframes.html">
                class.uw-iframes.php
              </a>
            
              
              <a class="source" href="class.uw-media-caption.html">
                class.uw-media-caption.php
              </a>
            
              
              <a class="source" href="class.uw-media-credit.html">
                class.uw-media-credit.php
              </a>
            
              
              <a class="source" href="class.uw-oembeds.html">
                class.uw-oembeds.php
              </a>
            
              
              <a class="source" href="class.uw-page-attributes-meta-box.html">
                class.uw-page-attributes-meta-box.php
              </a>
            
              
              <a class="source" href="class.uw-quicklinks.html">
                class.uw-quicklinks.php
              </a>
            
              
              <a class="source" href="class.uw-replace-media.html">
                class.uw-replace-media.php
              </a>
            
              
              <a class="source" href="class.uw-scripts.html">
                class.uw-scripts.php
              </a>
            
              
              <a class="source" href="class.uw-shortcodes.html">
                class.uw-shortcodes.php
              </a>
            
              
              <a class="source" href="class.uw-styles.html">
                class.uw-styles.php
              </a>
            
              
              <a class="source" href="class.uw-tinymce.html">
                class.uw-tinymce.php
              </a>
            
              
              <a class="source" href="class.uw.html">
                class.uw.php
              </a>
            
              
              <a class="source" href="class.youtube-shortcode.html">
                class.youtube-shortcode.php
              </a>
            
              
              <a class="source" href="sidebar.html">
                sidebar.php
              </a>
            
              
              <a class="source" href="template-big-hero.html">
                template-big-hero.php
              </a>
            
              
              <a class="source" href="template-no-hero.html">
                template-no-hero.php
              </a>
            
              
              <a class="source" href="template-no-sidebar.html">
                template-no-sidebar.php
              </a>
            
              
              <a class="source" href="template-no-title.html">
                template-no-title.php
              </a>
            
              
              <a class="source" href="template-small-hero.html">
                template-small-hero.php
              </a>
            
              
              <a class="source" href="thinstrip.html">
                thinstrip.php
              </a>
            
              
              <a class="source" href="class.uw-blogroll.html">
                class.uw-blogroll.php
              </a>
            
              
              <a class="source" href="class.uw-campus-map.html">
                class.uw-campus-map.php
              </a>
            
              
              <a class="source" href="class.uw-intro.html">
                class.uw-intro.php
              </a>
            
              
              <a class="source" href="class.uw-recent-posts.html">
                class.uw-recent-posts.php
              </a>
            
              
              <a class="source" href="class.uw-related-posts.html">
                class.uw-related-posts.php
              </a>
            
              
              <a class="source" href="class.uw-rss.html">
                class.uw-rss.php
              </a>
            
              
              <a class="source" href="class.uw-sidebar.html">
                class.uw-sidebar.php
              </a>
            
              
              <a class="source" href="class.uw-single-image.html">
                class.uw-single-image.php
              </a>
            
              
              <a class="source" href="class.uw-top-posts.html">
                class.uw-top-posts.php
              </a>
            
              
              <a class="source" href="class.uw-twitter.html">
                class.uw-twitter.php
              </a>
            
              
              <a class="source" href="class.uw-widget-visibility.html">
                class.uw-widget-visibility.php
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>class.uw-rss.php</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>&lt;?php
/**
 * UW RSS Widget and shortcode
 *  - Only difference between this and WP one is this shows images
 */

class UW_RSS extends WP_Widget
{
  const ID          = 'uw-widget-rss';
  const NAME        = 'UW RSS';
  const DESCRIPTION = 'Similar to the Wordpress RSS widget but allows a blurb before the RSS feed is listed.';
  const ITEMS       = 10;

  private static $WIDGET_DEFAULTS  = array(
    'url'          =&gt; true,
    'title'        =&gt; true,
    'items'        =&gt; 10,
    'show_summary' =&gt; true,
    'show_author'  =&gt; true,
    'show_date'    =&gt; true,
    'show_image'   =&gt; true
  );

  private static $SHORTCODE_DEFAULTS = array(
    'url'     =&gt; null,
    'number'  =&gt; 5,
    'title'   =&gt; null,
    'heading' =&gt; 'h3',
    'span'    =&gt; 4
  );

  function __construct()
  {

    add_shortcode( 'rss', array( $this, 'uw_rss_shortcode') );

		parent::WP_Widget(
      $id      = self::ID,
      $name    = self::NAME,
      $options = array(
        'description' =&gt; self::DESCRIPTION,
        'classname'   =&gt; self::ID
      )
    );
	}

  function form( $instance )
  {
    $inputs = wp_parse_args( $instance , self::$WIDGET_DEFAULTS );

    extract( $inputs );

    $number = esc_attr( $number );
    $title  = esc_attr( $title );
    $url    = esc_url( $url );
    $items  = ( $items &lt; 1 || 20 &lt; $items ) ? self::ITEMS : $items;

    if ( !empty($error) )
      echo '&lt;p class="widget-error"&gt;&lt;strong&gt;' . sprintf( __('RSS Error: %s'), $error) . '&lt;/strong&gt;&lt;/p&gt;';
  ?&gt;
		&lt;p&gt;
		&lt;label for="&lt;?php echo $this-&gt;get_field_id( 'title' ); ?&gt;"&gt;&lt;?php _e( 'Give the feed a title (optional):' ); ?&gt;&lt;/label&gt;
    &lt;input class="widefat" id="&lt;?php echo $this-&gt;get_field_id( 'title' ); ?&gt;" name="&lt;?php echo $this-&gt;get_field_name( 'title' ); ?&gt;" type="text" value="&lt;?php echo esc_attr( $instance['title']); ?&gt;" /&gt;
		&lt;/p&gt;

		&lt;p&gt;
		&lt;label for="&lt;?php echo $this-&gt;get_field_id( 'text' ); ?&gt;"&gt;&lt;?php _e( 'Featured blurb:' ); ?&gt;&lt;/label&gt;
		&lt;textarea class="widefat" style="resize:vertical" rows="14" cols="20" id="&lt;?php echo $this-&gt;get_field_id('text'); ?&gt;" name="&lt;?php echo $this-&gt;get_field_name('text'); ?&gt;"&gt;&lt;?php echo esc_textarea($instance['text']); ?&gt;&lt;/textarea&gt;
		&lt;/p&gt;

		&lt;p&gt;
		&lt;label for="&lt;?php echo $this-&gt;get_field_id( 'url' ); ?&gt;"&gt;&lt;?php _e( 'Enter the RSS feed URL here:' ); ?&gt;&lt;/label&gt;
		&lt;input class="widefat" id="&lt;?php echo $this-&gt;get_field_id( 'url' ); ?&gt;" name="&lt;?php echo $this-&gt;get_field_name( 'url' ); ?&gt;" type="text" value="&lt;?php echo esc_attr( $instance['url']); ?&gt;" /&gt;
		&lt;/p&gt;

    &lt;p&gt;
    &lt;label for="&lt;?php echo $this-&gt;get_field_id( 'items' ) ?&gt;"&gt;&lt;?php _e('Number of items to display:'); ?&gt;&lt;/label&gt;
    &lt;select id="&lt;?php echo $this-&gt;get_field_id( 'items' ) ?&gt;" name="&lt;?php echo $this-&gt;get_field_name( 'items' ) ?&gt;"&gt;
      &lt;?php
          for ( $i = 1; $i &lt;= 20; ++$i )
            echo "&lt;option value='$i' " . selected( $items, $i, false ) . "&gt;$i&lt;/option&gt;";
      ?&gt;
    &lt;/select&gt;
    &lt;/p&gt;

&lt;?php

  }

  function update( $new_instance, $old_instance )
  {
		$instance['url']          = esc_url_raw( strip_tags( $new_instance['url'] ) );
		$instance['title']        = strip_tags( $new_instance['title'] );
		$instance['items']        = (int) ( $new_instance['items'] );
		$instance['show_image']   = (int) ( $new_instance['show_image'] );
		$instance['show_summary'] = (int) ( $new_instance['show_summary'] );
		$instance['show_author']  = (int) ( $new_instance['show_author'] );
		$instance['show_date']    = (int) ( $new_instance['show_date'] );</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>todo: this still necessary?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> ( current_user_can(<span class="hljs-string">'unfiltered_html'</span>) )
			<span class="hljs-variable">$instance</span>[<span class="hljs-string">'text'</span>] =  <span class="hljs-variable">$new_instance</span>[<span class="hljs-string">'text'</span>];
		<span class="hljs-keyword">else</span>
			<span class="hljs-variable">$instance</span>[<span class="hljs-string">'text'</span>] = stripslashes( wp_filter_post_kses( addslashes( <span class="hljs-variable">$new_instance</span>[<span class="hljs-string">'text'</span>]) ) );

		<span class="hljs-keyword">return</span> <span class="hljs-variable">$instance</span>;
	}

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">widget</span><span class="hljs-params">( <span class="hljs-variable">$args</span>, <span class="hljs-variable">$instance</span> )</span>
  </span>{
    extract( <span class="hljs-variable">$args</span> );
    extract( <span class="hljs-variable">$instance</span> );

    <span class="hljs-variable">$title</span> = apply_filters( <span class="hljs-string">'widget_title'</span>, <span class="hljs-variable">$title</span> );

    <span class="hljs-variable">$content</span> = <span class="hljs-string">'&lt;span&gt;&lt;/span&gt;'</span>;

    <span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">empty</span>( <span class="hljs-variable">$title</span> ) ) <span class="hljs-variable">$content</span> .= <span class="hljs-variable">$before_title</span> . <span class="hljs-variable">$title</span> . <span class="hljs-variable">$after_title</span>;

    <span class="hljs-variable">$content</span> .= <span class="hljs-string">"&lt;div class=\"featured\"&gt;$text&lt;/div&gt;"</span>;

    <span class="hljs-variable">$content</span> .= do_shortcode( <span class="hljs-string">"[rss url={$url}]"</span>);

    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$before_widget</span> . <span class="hljs-variable">$content</span> . <span class="hljs-variable">$after_widget</span>;
  }


  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">uw_rss_shortcode</span><span class="hljs-params">( <span class="hljs-variable">$atts</span> )</span>
  </span>{
    extract( shortcode_atts( <span class="hljs-keyword">self</span>::<span class="hljs-variable">$SHORTCODE_DEFAULTS</span>, <span class="hljs-variable">$atts</span> ) );

    <span class="hljs-keyword">if</span> ( <span class="hljs-variable">$url</span> == <span class="hljs-keyword">null</span> || is_feed() ) <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;

    <span class="hljs-variable">$title</span> = apply_filters( <span class="hljs-string">'widget_title'</span>, <span class="hljs-variable">$title</span> );

    <span class="hljs-variable">$content</span> = <span class="hljs-string">'&lt;span&gt;&lt;/span&gt;'</span>;

     <span class="hljs-variable">$rss</span> = fetch_feed( <span class="hljs-variable">$url</span> );

      <span class="hljs-keyword">if</span> ( ! is_wp_error( <span class="hljs-variable">$rss</span> ) )
      {
        <span class="hljs-variable">$url</span>       = <span class="hljs-variable">$rss</span><span class="hljs-variable">-&gt;get_permalink</span>();
        <span class="hljs-variable">$maxitems</span>  = <span class="hljs-variable">$rss</span><span class="hljs-variable">-&gt;get_item_quantity</span>(<span class="hljs-variable">$instance</span>[<span class="hljs-string">'items'</span>]);

        <span class="hljs-variable">$rss_items</span> = <span class="hljs-variable">$rss</span><span class="hljs-variable">-&gt;get_items</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>);

        <span class="hljs-variable">$content</span>  .= <span class="hljs-string">"&lt;ul class=\"uw-widget-rss\"&gt;"</span>;

        <span class="hljs-keyword">foreach</span> ( <span class="hljs-variable">$rss_items</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$index</span>=&gt;<span class="hljs-variable">$item</span> )
        {
          <span class="hljs-variable">$title</span> = <span class="hljs-variable">$item</span><span class="hljs-variable">-&gt;get_title</span>();
          <span class="hljs-variable">$link</span>  = <span class="hljs-variable">$item</span><span class="hljs-variable">-&gt;get_link</span>();

          <span class="hljs-variable">$enclosure</span> = <span class="hljs-variable">$item</span><span class="hljs-variable">-&gt;get_enclosure</span>();
          <span class="hljs-variable">$src</span> = <span class="hljs-variable">$enclosure</span><span class="hljs-variable">-&gt;link</span>;

          <span class="hljs-variable">$attr</span>  = esc_attr(strip_tags(<span class="hljs-variable">$title</span>));

          <span class="hljs-variable">$image</span> = ( <span class="hljs-variable">$enclosure</span><span class="hljs-variable">-&gt;link</span> ) ?
             <span class="hljs-string">"&lt;a class='widget-thumbnail' href='$link' title='$attr'&gt;&lt;img src='$src' title='$attr' /&gt;&lt;/a&gt;"</span> : <span class="hljs-string">''</span>;

          <span class="hljs-variable">$date</span> = <span class="hljs-variable">$item</span><span class="hljs-variable">-&gt;get_date</span>();
          <span class="hljs-variable">$date</span> = human_time_diff( strtotime( <span class="hljs-variable">$date</span> ) ) . <span class="hljs-string">' ago'</span>;

          <span class="hljs-variable">$title</span> = <span class="hljs-string">"&lt;a class='widget-link' href='$link' title='$attr'&gt;$attr&lt;span&gt;$date&lt;/span&gt;&lt;/a&gt;"</span>;

          <span class="hljs-variable">$content</span> .= <span class="hljs-string">"&lt;li&gt;$image$title&lt;/li&gt;"</span>;

        }

        <span class="hljs-variable">$content</span> .= <span class="hljs-string">'&lt;/ul&gt;'</span>;
        <span class="hljs-variable">$content</span> .= <span class="hljs-string">"&lt;a class=\"widget-more more\" href=\"$url\"&gt;More&lt;/a&gt;"</span>;
      }

      <span class="hljs-keyword">return</span> <span class="hljs-variable">$content</span>;
  }

}

register_widget( <span class="hljs-string">'UW_RSS'</span> );</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
