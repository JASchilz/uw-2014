<!DOCTYPE html>

<html>
<head>
  <title>class.uw-widget-visibility.php</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="404.html">
                404.php
              </a>
            
              
              <a class="source" href="application.html">
                application.php
              </a>
            
              
              <a class="source" href="archive.html">
                archive.php
              </a>
            
              
              <a class="source" href="breadcrumbs.html">
                breadcrumbs.php
              </a>
            
              
              <a class="source" href="comments.html">
                comments.php
              </a>
            
              
              <a class="source" href="content-archive.html">
                content-archive.php
              </a>
            
              
              <a class="source" href="content-image.html">
                content-image.php
              </a>
            
              
              <a class="source" href="content-page.html">
                content-page.php
              </a>
            
              
              <a class="source" href="content-pdf.html">
                content-pdf.php
              </a>
            
              
              <a class="source" href="content.html">
                content.php
              </a>
            
              
              <a class="source" href="footer.html">
                footer.php
              </a>
            
              
              <a class="source" href="functions.html">
                functions.php
              </a>
            
              
              <a class="source" href="header-image.html">
                header-image.php
              </a>
            
              
              <a class="source" href="header.html">
                header.php
              </a>
            
              
              <a class="source" href="image.html">
                image.php
              </a>
            
              
              <a class="source" href="template-functions.html">
                template-functions.php
              </a>
            
              
              <a class="source" href="index.html">
                index.php
              </a>
            
              
              <a class="source" href="uw.html">
                uw.js
              </a>
            
              
              <a class="source" href="menu-mobile.html">
                menu-mobile.php
              </a>
            
              
              <a class="source" href="page.html">
                page.php
              </a>
            
              
              <a class="source" href="search.html">
                search.php
              </a>
            
              
              <a class="source" href="searchform.html">
                searchform.php
              </a>
            
              
              <a class="source" href="class.button-shortcode.html">
                class.button-shortcode.php
              </a>
            
              
              <a class="source" href="class.dropdowns_walker.html">
                class.dropdowns_walker.php
              </a>
            
              
              <a class="source" href="class.filters.html">
                class.filters.php
              </a>
            
              
              <a class="source" href="class.googleapps.html">
                class.googleapps.php
              </a>
            
              
              <a class="source" href="class.images.html">
                class.images.php
              </a>
            
              
              <a class="source" href="class.install.html">
                class.install.php
              </a>
            
              
              <a class="source" href="class.mimes.html">
                class.mimes.php
              </a>
            
              
              <a class="source" href="class.squish_bugs.html">
                class.squish_bugs.php
              </a>
            
              
              <a class="source" href="class.tile-box-shortcode.html">
                class.tile-box-shortcode.php
              </a>
            
              
              <a class="source" href="class.trumba-shortcode.html">
                class.trumba-shortcode.php
              </a>
            
              
              <a class="source" href="class.users.html">
                class.users.php
              </a>
            
              
              <a class="source" href="class.uw-carousel.html">
                class.uw-carousel.php
              </a>
            
              
              <a class="source" href="class.uw-directory.html">
                class.uw-directory.php
              </a>
            
              
              <a class="source" href="class.uw-documentation.html">
                class.uw-documentation.php
              </a>
            
              
              <a class="source" href="class.uw-dropdowns.html">
                class.uw-dropdowns.php
              </a>
            
              
              <a class="source" href="class.uw-enclosure.html">
                class.uw-enclosure.php
              </a>
            
              
              <a class="source" href="class.uw-iframes.html">
                class.uw-iframes.php
              </a>
            
              
              <a class="source" href="class.uw-media-caption.html">
                class.uw-media-caption.php
              </a>
            
              
              <a class="source" href="class.uw-media-credit.html">
                class.uw-media-credit.php
              </a>
            
              
              <a class="source" href="class.uw-oembeds.html">
                class.uw-oembeds.php
              </a>
            
              
              <a class="source" href="class.uw-page-attributes-meta-box.html">
                class.uw-page-attributes-meta-box.php
              </a>
            
              
              <a class="source" href="class.uw-quicklinks.html">
                class.uw-quicklinks.php
              </a>
            
              
              <a class="source" href="class.uw-replace-media.html">
                class.uw-replace-media.php
              </a>
            
              
              <a class="source" href="class.uw-scripts.html">
                class.uw-scripts.php
              </a>
            
              
              <a class="source" href="class.uw-shortcodes.html">
                class.uw-shortcodes.php
              </a>
            
              
              <a class="source" href="class.uw-styles.html">
                class.uw-styles.php
              </a>
            
              
              <a class="source" href="class.uw-tinymce.html">
                class.uw-tinymce.php
              </a>
            
              
              <a class="source" href="class.uw.html">
                class.uw.php
              </a>
            
              
              <a class="source" href="class.youtube-shortcode.html">
                class.youtube-shortcode.php
              </a>
            
              
              <a class="source" href="sidebar.html">
                sidebar.php
              </a>
            
              
              <a class="source" href="template-big-hero.html">
                template-big-hero.php
              </a>
            
              
              <a class="source" href="template-no-hero.html">
                template-no-hero.php
              </a>
            
              
              <a class="source" href="template-no-sidebar.html">
                template-no-sidebar.php
              </a>
            
              
              <a class="source" href="template-no-title.html">
                template-no-title.php
              </a>
            
              
              <a class="source" href="template-small-hero.html">
                template-small-hero.php
              </a>
            
              
              <a class="source" href="thinstrip.html">
                thinstrip.php
              </a>
            
              
              <a class="source" href="class.uw-blogroll.html">
                class.uw-blogroll.php
              </a>
            
              
              <a class="source" href="class.uw-campus-map.html">
                class.uw-campus-map.php
              </a>
            
              
              <a class="source" href="class.uw-intro.html">
                class.uw-intro.php
              </a>
            
              
              <a class="source" href="class.uw-recent-posts.html">
                class.uw-recent-posts.php
              </a>
            
              
              <a class="source" href="class.uw-related-posts.html">
                class.uw-related-posts.php
              </a>
            
              
              <a class="source" href="class.uw-rss.html">
                class.uw-rss.php
              </a>
            
              
              <a class="source" href="class.uw-sidebar.html">
                class.uw-sidebar.php
              </a>
            
              
              <a class="source" href="class.uw-single-image.html">
                class.uw-single-image.php
              </a>
            
              
              <a class="source" href="class.uw-top-posts.html">
                class.uw-top-posts.php
              </a>
            
              
              <a class="source" href="class.uw-twitter.html">
                class.uw-twitter.php
              </a>
            
              
              <a class="source" href="class.uw-widget-visibility.html">
                class.uw-widget-visibility.php
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>class.uw-widget-visibility.php</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-preprocessor">&lt;?php</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Hide or show widgets conditionally.</p>
<p>Forked from the JetPack plugin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UW_Widget_Conditions</span>
</span>{
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">if</span> ( is_admin() )
    {

      add_action( <span class="hljs-string">'sidebar_admin_setup'</span>, <span class="hljs-keyword">array</span>( <span class="hljs-keyword">__CLASS__</span>, <span class="hljs-string">'widget_admin_setup'</span> ) );
      add_filter( <span class="hljs-string">'widget_update_callback'</span>, <span class="hljs-keyword">array</span>( <span class="hljs-keyword">__CLASS__</span>, <span class="hljs-string">'widget_update'</span> ), <span class="hljs-number">10</span>, <span class="hljs-number">3</span> );
      add_action( <span class="hljs-string">'in_widget_form'</span>, <span class="hljs-keyword">array</span>( <span class="hljs-keyword">__CLASS__</span>, <span class="hljs-string">'widget_conditions_admin'</span> ), <span class="hljs-number">10</span>, <span class="hljs-number">3</span> );
      add_action( <span class="hljs-string">'wp_ajax_widget_conditions_options'</span>, <span class="hljs-keyword">array</span>( <span class="hljs-keyword">__CLASS__</span>, <span class="hljs-string">'widget_conditions_options'</span> ) );

    } <span class="hljs-keyword">else</span> {

      add_action( <span class="hljs-string">'widget_display_callback'</span>, <span class="hljs-keyword">array</span>( <span class="hljs-keyword">__CLASS__</span>, <span class="hljs-string">'filter_widget'</span> ) );
      add_action( <span class="hljs-string">'sidebars_widgets'</span>, <span class="hljs-keyword">array</span>( <span class="hljs-keyword">__CLASS__</span>, <span class="hljs-string">'sidebars_widgets'</span> ) );

    }
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">widget_admin_setup</span><span class="hljs-params">()</span>
  </span>{
    wp_enqueue_style( <span class="hljs-string">'widget-conditions'</span>, get_template_directory_uri() .  <span class="hljs-string">'/assets/admin/css/uw.widget-conditions.css'</span> );
    wp_enqueue_script( <span class="hljs-string">'widget-conditions'</span>, get_template_directory_uri() . <span class="hljs-string">'/assets/admin/js/uw.widget-conditions.js'</span> , <span class="hljs-keyword">array</span>( <span class="hljs-string">'jquery'</span>, <span class="hljs-string">'jquery-ui-core'</span> ), <span class="hljs-number">20140422</span>, <span class="hljs-keyword">true</span> );
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Provided a second level of granularity for widget conditions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">widget_conditions_options_echo</span><span class="hljs-params">( <span class="hljs-variable">$major</span> = <span class="hljs-string">''</span>, <span class="hljs-variable">$minor</span> = <span class="hljs-string">''</span> )</span>
  </span>{
    <span class="hljs-keyword">switch</span> ( <span class="hljs-variable">$major</span> )
    {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'category'</span>:
        <span class="hljs-preprocessor">?&gt;</span>
        &lt;option value=<span class="hljs-string">""</span>&gt;<span class="hljs-preprocessor">&lt;?php</span> _e( <span class="hljs-string">'All category pages'</span>, <span class="hljs-string">'jetpack'</span> ); <span class="hljs-preprocessor">?&gt;</span>&lt;/option&gt;
        <span class="hljs-preprocessor">&lt;?php</span>

        <span class="hljs-variable">$categories</span> = get_categories( <span class="hljs-keyword">array</span>( <span class="hljs-string">'number'</span> =&gt; <span class="hljs-number">1000</span>, <span class="hljs-string">'orderby'</span> =&gt; <span class="hljs-string">'count'</span>, <span class="hljs-string">'order'</span> =&gt; <span class="hljs-string">'DESC'</span> ) );
        usort( <span class="hljs-variable">$categories</span>, <span class="hljs-keyword">array</span>( <span class="hljs-keyword">__CLASS__</span>, <span class="hljs-string">'strcasecmp_name'</span> ) );

        <span class="hljs-keyword">foreach</span> ( <span class="hljs-variable">$categories</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$category</span> ) {
          <span class="hljs-preprocessor">?&gt;</span>
          &lt;option value=<span class="hljs-string">"&lt;?php echo esc_attr( $category-&gt;term_id ); ?&gt;"</span> <span class="hljs-preprocessor">&lt;?php</span> selected( <span class="hljs-variable">$category</span><span class="hljs-variable">-&gt;term_id</span>, <span class="hljs-variable">$minor</span> ); <span class="hljs-preprocessor">?&gt;</span>&gt;<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-keyword">echo</span> esc_html( <span class="hljs-variable">$category</span><span class="hljs-variable">-&gt;name</span> ); <span class="hljs-preprocessor">?&gt;</span>&lt;/option&gt;
          <span class="hljs-preprocessor">&lt;?php</span>
        }
      <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'author'</span>:
        <span class="hljs-preprocessor">?&gt;</span>
        &lt;option value=<span class="hljs-string">""</span>&gt;<span class="hljs-preprocessor">&lt;?php</span> _e( <span class="hljs-string">'All author pages'</span>, <span class="hljs-string">'jetpack'</span> ); <span class="hljs-preprocessor">?&gt;</span>&lt;/option&gt;
        <span class="hljs-preprocessor">&lt;?php</span>

        <span class="hljs-keyword">foreach</span> ( get_users( <span class="hljs-keyword">array</span>( <span class="hljs-string">'orderby'</span> =&gt; <span class="hljs-string">'name'</span>, <span class="hljs-string">'exclude_admin'</span> =&gt; <span class="hljs-keyword">true</span> ) ) <span class="hljs-keyword">as</span> <span class="hljs-variable">$author</span> ) {
          <span class="hljs-preprocessor">?&gt;</span>
          &lt;option value=<span class="hljs-string">"&lt;?php echo esc_attr( $author-&gt;ID ); ?&gt;"</span> <span class="hljs-preprocessor">&lt;?php</span> selected( <span class="hljs-variable">$author</span><span class="hljs-variable">-&gt;ID</span>, <span class="hljs-variable">$minor</span> ); <span class="hljs-preprocessor">?&gt;</span>&gt;<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-keyword">echo</span> esc_html( <span class="hljs-variable">$author</span><span class="hljs-variable">-&gt;display_name</span> ); <span class="hljs-preprocessor">?&gt;</span>&lt;/option&gt;
          <span class="hljs-preprocessor">&lt;?php</span>
        }
      <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'tag'</span>:
        <span class="hljs-preprocessor">?&gt;</span>
        &lt;option value=<span class="hljs-string">""</span>&gt;<span class="hljs-preprocessor">&lt;?php</span> _e( <span class="hljs-string">'All tag pages'</span>, <span class="hljs-string">'jetpack'</span> ); <span class="hljs-preprocessor">?&gt;</span>&lt;/option&gt;
        <span class="hljs-preprocessor">&lt;?php</span>

        <span class="hljs-variable">$tags</span> = get_tags( <span class="hljs-keyword">array</span>( <span class="hljs-string">'number'</span> =&gt; <span class="hljs-number">1000</span>, <span class="hljs-string">'orderby'</span> =&gt; <span class="hljs-string">'count'</span>, <span class="hljs-string">'order'</span> =&gt; <span class="hljs-string">'DESC'</span> ) );
        usort( <span class="hljs-variable">$tags</span>, <span class="hljs-keyword">array</span>( <span class="hljs-keyword">__CLASS__</span>, <span class="hljs-string">'strcasecmp_name'</span> ) );

        <span class="hljs-keyword">foreach</span> ( <span class="hljs-variable">$tags</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$tag</span> ) {
          <span class="hljs-preprocessor">?&gt;</span>
          &lt;option value=<span class="hljs-string">"&lt;?php echo esc_attr($tag-&gt;term_id ); ?&gt;"</span> <span class="hljs-preprocessor">&lt;?php</span> selected( <span class="hljs-variable">$tag</span><span class="hljs-variable">-&gt;term_id</span>, <span class="hljs-variable">$minor</span> ); <span class="hljs-preprocessor">?&gt;</span>&gt;<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-keyword">echo</span> esc_html( <span class="hljs-variable">$tag</span><span class="hljs-variable">-&gt;name</span> ); <span class="hljs-preprocessor">?&gt;</span>&lt;/option&gt;
          <span class="hljs-preprocessor">&lt;?php</span>
        }
      <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'date'</span>:
        <span class="hljs-preprocessor">?&gt;</span>
        &lt;option value=<span class="hljs-string">""</span> <span class="hljs-preprocessor">&lt;?php</span> selected( <span class="hljs-string">''</span>, <span class="hljs-variable">$minor</span> ); <span class="hljs-preprocessor">?&gt;</span>&gt;<span class="hljs-preprocessor">&lt;?php</span> _e( <span class="hljs-string">'All date archives'</span>, <span class="hljs-string">'jetpack'</span> ); <span class="hljs-preprocessor">?&gt;</span>&lt;/option&gt;
        &lt;option value=<span class="hljs-string">"day"</span><span class="hljs-preprocessor">&lt;?php</span> selected( <span class="hljs-string">'day'</span>, <span class="hljs-variable">$minor</span> ); <span class="hljs-preprocessor">?&gt;</span>&gt;<span class="hljs-preprocessor">&lt;?php</span> _e( <span class="hljs-string">'Daily archives'</span>, <span class="hljs-string">'jetpack'</span> ); <span class="hljs-preprocessor">?&gt;</span>&lt;/option&gt;
        &lt;option value=<span class="hljs-string">"month"</span><span class="hljs-preprocessor">&lt;?php</span> selected( <span class="hljs-string">'month'</span>, <span class="hljs-variable">$minor</span> ); <span class="hljs-preprocessor">?&gt;</span>&gt;<span class="hljs-preprocessor">&lt;?php</span> _e( <span class="hljs-string">'Monthly archives'</span>, <span class="hljs-string">'jetpack'</span> ); <span class="hljs-preprocessor">?&gt;</span>&lt;/option&gt;
        &lt;option value=<span class="hljs-string">"year"</span><span class="hljs-preprocessor">&lt;?php</span> selected( <span class="hljs-string">'year'</span>, <span class="hljs-variable">$minor</span> ); <span class="hljs-preprocessor">?&gt;</span>&gt;<span class="hljs-preprocessor">&lt;?php</span> _e( <span class="hljs-string">'Yearly archives'</span>, <span class="hljs-string">'jetpack'</span> ); <span class="hljs-preprocessor">?&gt;</span>&lt;/option&gt;
        <span class="hljs-preprocessor">&lt;?php</span>
      <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'page'</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Previously hardcoded post type options.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ( ! <span class="hljs-variable">$minor</span> )
          <span class="hljs-variable">$minor</span> = <span class="hljs-string">'post_type-page'</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-string">'post'</span> == <span class="hljs-variable">$minor</span> )
          <span class="hljs-variable">$minor</span> = <span class="hljs-string">'post_type-post'</span>;

        <span class="hljs-preprocessor">?&gt;</span>
        &lt;option value=<span class="hljs-string">"front"</span> <span class="hljs-preprocessor">&lt;?php</span> selected( <span class="hljs-string">'front'</span>, <span class="hljs-variable">$minor</span> ); <span class="hljs-preprocessor">?&gt;</span>&gt;<span class="hljs-preprocessor">&lt;?php</span> _e( <span class="hljs-string">'Front page'</span>, <span class="hljs-string">'jetpack'</span> ); <span class="hljs-preprocessor">?&gt;</span>&lt;/option&gt;
        &lt;option value=<span class="hljs-string">"posts"</span> <span class="hljs-preprocessor">&lt;?php</span> selected( <span class="hljs-string">'posts'</span>, <span class="hljs-variable">$minor</span> ); <span class="hljs-preprocessor">?&gt;</span>&gt;<span class="hljs-preprocessor">&lt;?php</span> _e( <span class="hljs-string">'Posts page'</span>, <span class="hljs-string">'jetpack'</span> ); <span class="hljs-preprocessor">?&gt;</span>&lt;/option&gt;
        &lt;option value=<span class="hljs-string">"archive"</span> <span class="hljs-preprocessor">&lt;?php</span> selected( <span class="hljs-string">'archive'</span>, <span class="hljs-variable">$minor</span> ); <span class="hljs-preprocessor">?&gt;</span>&gt;<span class="hljs-preprocessor">&lt;?php</span> _e( <span class="hljs-string">'Archive page'</span>, <span class="hljs-string">'jetpack'</span> ); <span class="hljs-preprocessor">?&gt;</span>&lt;/option&gt;
        &lt;option value=<span class="hljs-string">"404"</span> <span class="hljs-preprocessor">&lt;?php</span> selected( <span class="hljs-string">'404'</span>, <span class="hljs-variable">$minor</span> ); <span class="hljs-preprocessor">?&gt;</span>&gt;<span class="hljs-preprocessor">&lt;?php</span> _e( <span class="hljs-string">'404 error page'</span>, <span class="hljs-string">'jetpack'</span> ); <span class="hljs-preprocessor">?&gt;</span>&lt;/option&gt;
        &lt;option value=<span class="hljs-string">"search"</span> <span class="hljs-preprocessor">&lt;?php</span> selected( <span class="hljs-string">'search'</span>, <span class="hljs-variable">$minor</span> ); <span class="hljs-preprocessor">?&gt;</span>&gt;<span class="hljs-preprocessor">&lt;?php</span> _e( <span class="hljs-string">'Search results'</span>, <span class="hljs-string">'jetpack'</span> ); <span class="hljs-preprocessor">?&gt;</span>&lt;/option&gt;
        &lt;optgroup label=<span class="hljs-string">"&lt;?php esc_attr_e( 'Post type:', 'jetpack' ); ?&gt;"</span>&gt;
          <span class="hljs-preprocessor">&lt;?php</span>

          <span class="hljs-variable">$post_types</span> = get_post_types( <span class="hljs-keyword">array</span>( <span class="hljs-string">'public'</span> =&gt; <span class="hljs-keyword">true</span> ), <span class="hljs-string">'objects'</span> );

          <span class="hljs-keyword">foreach</span> ( <span class="hljs-variable">$post_types</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$post_type</span> ) {
            <span class="hljs-preprocessor">?&gt;</span>
            &lt;option value=<span class="hljs-string">"&lt;?php echo esc_attr( 'post_type-' . $post_type-&gt;name ); ?&gt;"</span> <span class="hljs-preprocessor">&lt;?php</span> selected( <span class="hljs-string">'post_type-'</span> . <span class="hljs-variable">$post_type</span><span class="hljs-variable">-&gt;name</span>, <span class="hljs-variable">$minor</span> ); <span class="hljs-preprocessor">?&gt;</span>&gt;<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-keyword">echo</span> esc_html( <span class="hljs-variable">$post_type</span><span class="hljs-variable">-&gt;labels</span><span class="hljs-variable">-&gt;singular_name</span> ); <span class="hljs-preprocessor">?&gt;</span>&lt;/option&gt;
            <span class="hljs-preprocessor">&lt;?php</span>
          }

          <span class="hljs-preprocessor">?&gt;</span>
        &lt;/optgroup&gt;
        &lt;optgroup label=<span class="hljs-string">"&lt;?php esc_attr_e( 'Static page:', 'jetpack' ); ?&gt;"</span>&gt;
          <span class="hljs-preprocessor">&lt;?php</span>

          <span class="hljs-keyword">echo</span> str_replace( <span class="hljs-string">' value="'</span> . esc_attr( <span class="hljs-variable">$minor</span> ) . <span class="hljs-string">'"'</span>, <span class="hljs-string">' value="'</span> . esc_attr( <span class="hljs-variable">$minor</span> ) . <span class="hljs-string">'" selected="selected"'</span>, preg_replace( <span class="hljs-string">'/&lt;\/?select[^&gt;]*?&gt;/i'</span>, <span class="hljs-string">''</span>, wp_dropdown_pages( <span class="hljs-keyword">array</span>( <span class="hljs-string">'echo'</span> =&gt; <span class="hljs-keyword">false</span> ) ) ) );

          <span class="hljs-preprocessor">?&gt;</span>
        &lt;/optgroup&gt;
        <span class="hljs-preprocessor">&lt;?php</span>
      <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'taxonomy'</span>:
        <span class="hljs-preprocessor">?&gt;</span>
        &lt;option value=<span class="hljs-string">""</span>&gt;<span class="hljs-preprocessor">&lt;?php</span> _e( <span class="hljs-string">'All taxonomy pages'</span>, <span class="hljs-string">'jetpack'</span> ); <span class="hljs-preprocessor">?&gt;</span>&lt;/option&gt;
        <span class="hljs-preprocessor">&lt;?php</span>

        <span class="hljs-variable">$taxonomies</span> = get_taxonomies( <span class="hljs-keyword">array</span>( <span class="hljs-string">'_builtin'</span> =&gt; <span class="hljs-keyword">false</span> ), <span class="hljs-string">'objects'</span> );
        usort( <span class="hljs-variable">$taxonomies</span>, <span class="hljs-keyword">array</span>( <span class="hljs-keyword">__CLASS__</span>, <span class="hljs-string">'strcasecmp_name'</span> ) );

        <span class="hljs-keyword">foreach</span> ( <span class="hljs-variable">$taxonomies</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$taxonomy</span> ) {
          <span class="hljs-preprocessor">?&gt;</span>
          &lt;optgroup label=<span class="hljs-string">"&lt;?php esc_attr_e( $taxonomy-&gt;labels-&gt;name . ':', 'jetpack' ); ?&gt;"</span>&gt;
            &lt;option value=<span class="hljs-string">"&lt;?php echo esc_attr( $taxonomy-&gt;name ); ?&gt;"</span> <span class="hljs-preprocessor">&lt;?php</span> selected( <span class="hljs-variable">$taxonomy</span><span class="hljs-variable">-&gt;name</span>, <span class="hljs-variable">$minor</span> ); <span class="hljs-preprocessor">?&gt;</span>&gt;<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-keyword">echo</span> <span class="hljs-string">'All '</span> . esc_html( <span class="hljs-variable">$taxonomy</span><span class="hljs-variable">-&gt;name</span> ) . <span class="hljs-string">' pages'</span>; <span class="hljs-preprocessor">?&gt;</span>&lt;/option&gt;
          <span class="hljs-preprocessor">&lt;?php</span>

          <span class="hljs-variable">$terms</span> = get_terms( <span class="hljs-keyword">array</span>( <span class="hljs-variable">$taxonomy</span><span class="hljs-variable">-&gt;name</span> ), <span class="hljs-keyword">array</span>( <span class="hljs-string">'number'</span> =&gt; <span class="hljs-number">250</span>, <span class="hljs-string">'hide_empty'</span> =&gt; <span class="hljs-keyword">false</span> ) );
          <span class="hljs-keyword">foreach</span> ( <span class="hljs-variable">$terms</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$term</span> ) {
            <span class="hljs-preprocessor">?&gt;</span>
            &lt;option value=<span class="hljs-string">"&lt;?php echo esc_attr( $taxonomy-&gt;name . '_tax_' . $term-&gt;term_id ); ?&gt;"</span> <span class="hljs-preprocessor">&lt;?php</span> selected( <span class="hljs-variable">$taxonomy</span><span class="hljs-variable">-&gt;name</span> . <span class="hljs-string">'_tax_'</span> . <span class="hljs-variable">$term</span><span class="hljs-variable">-&gt;term_id</span>, <span class="hljs-variable">$minor</span> ); <span class="hljs-preprocessor">?&gt;</span>&gt;<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-keyword">echo</span> esc_html( <span class="hljs-variable">$term</span><span class="hljs-variable">-&gt;name</span> ); <span class="hljs-preprocessor">?&gt;</span>&lt;/option&gt;
            <span class="hljs-preprocessor">&lt;?php</span>
          }

          <span class="hljs-preprocessor">?&gt;</span>
        &lt;/optgroup&gt;
        <span class="hljs-preprocessor">&lt;?php</span>
        }
      <span class="hljs-keyword">break</span>;
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>This is the AJAX endpoint for the second level of conditions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">widget_conditions_options</span><span class="hljs-params">()</span>
  </span>{
    <span class="hljs-keyword">self</span>::widget_conditions_options_echo( <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'major'</span>], <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'minor'</span>] ) ? <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'minor'</span>] : <span class="hljs-string">''</span> );
    wp_die();
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p> Add the widget conditions to each widget in the admin.</p>
<p> @param $widget unused.
 @param $return unused.
 @param array $instance The widget settings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  public static function widget_conditions_admin( $widget, $return, $instance )
  {
    $conditions = array();

    if ( isset( $instance['conditions'] ) )
      $conditions = $instance['conditions'];

    if ( ! isset( $conditions['action'] ) )
      $conditions['action'] = 'show';

    if ( empty( $conditions['rules'] ) )
      $conditions['rules'][] = array( 'major' =&gt; '', 'minor' =&gt; '' );

    ?&gt;
    &lt;div class="widget-conditional &lt;?php if ( empty( $_POST['widget-conditions-visible'] ) || $_POST['widget-conditions-visible'] == '0' ) { ?&gt;widget-conditional-hide&lt;?php } ?&gt;"&gt;
      &lt;input type="hidden" name="widget-conditions-visible" value="&lt;?php if ( isset( $_POST['widget-conditions-visible'] ) ) { echo esc_attr( $_POST['widget-conditions-visible'] ); } else { ?&gt;0&lt;?php } ?&gt;" /&gt;
      &lt;?php if ( ! isset( $_POST['widget-conditions-visible'] ) ) { ?&gt;&lt;a href="#" class="button display-options"&gt;&lt;?php _e( 'Visibility', 'jetpack' ); ?&gt;&lt;/a&gt;&lt;?php } ?&gt;
      &lt;div class="widget-conditional-inner"&gt;
        &lt;div class="condition-top"&gt;
          &lt;?php printf( _x( '%s if:', 'placeholder: dropdown menu to select widget visibility; hide if or show if', 'jetpack' ), '&lt;select name="conditions[action]"&gt;&lt;option value="show" ' . selected( $conditions['action'], 'show', false ) . '&gt;' . esc_html_x( 'Show', 'Used in the "%s if:" translation for the widget visibility dropdown', 'jetpack' ) . '&lt;/option&gt;&lt;option value="hide" ' . selected( $conditions['action'], 'hide', false ) . '&gt;' . esc_html_x( 'Hide', 'Used in the "%s if:" translation for the widget visibility dropdown', 'jetpack' ) . '&lt;/option&gt;&lt;/select&gt;' ); ?&gt;
        &lt;/div&gt;&lt;!-- .condition-top --&gt;

        &lt;div class="conditions"&gt;
          &lt;?php

          foreach ( $conditions['rules'] as $rule ) {
            ?&gt;
            &lt;div class="condition"&gt;
              &lt;div class="alignleft"&gt;
                &lt;select class="conditions-rule-major" name="conditions[rules_major][]"&gt;
                  &lt;option value="" &lt;?php selected( "", $rule['major'] ); ?&gt;&gt;&lt;?php echo esc_html_x( '-- Select --', 'Used as the default option in a dropdown list', 'jetpack' ); ?&gt;&lt;/option&gt;
                  &lt;option value="category" &lt;?php selected( "category", $rule['major'] ); ?&gt;&gt;&lt;?php esc_html_e( 'Category', 'jetpack' ); ?&gt;&lt;/option&gt;
                  &lt;option value="author" &lt;?php selected( "author", $rule['major'] ); ?&gt;&gt;&lt;?php echo esc_html_x( 'Author', 'Noun, as in: "The author of this post is..."', 'jetpack' ); ?&gt;&lt;/option&gt;
                  &lt;option value="tag" &lt;?php selected( "tag", $rule['major'] ); ?&gt;&gt;&lt;?php echo esc_html_x( 'Tag', 'Noun, as in: "This post has one tag."', 'jetpack' ); ?&gt;&lt;/option&gt;
                  &lt;option value="date" &lt;?php selected( "date", $rule['major'] ); ?&gt;&gt;&lt;?php echo esc_html_x( 'Date', 'Noun, as in: "This page is a date archive."', 'jetpack' ); ?&gt;&lt;/option&gt;
                  &lt;option value="page" &lt;?php selected( "page", $rule['major'] ); ?&gt;&gt;&lt;?php echo esc_html_x( 'Page', 'Example: The user is looking at a page, not a post.', 'jetpack' ); ?&gt;&lt;/option&gt;
                  &lt;?php if ( get_taxonomies( array( '_builtin' =&gt; false ) ) ) : ?&gt;
                  &lt;option value="taxonomy" &lt;?php selected( "taxonomy", $rule['major'] ); ?&gt;&gt;&lt;?php echo esc_html_x( 'Taxonomy', 'Noun, as in: "This post has one taxonomy."', 'jetpack' ); ?&gt;&lt;/option&gt;
                  &lt;?php endif; ?&gt;
                &lt;/select&gt;
                &lt;?php _ex( 'is', 'Widget Visibility: {Rule Major [Page]} is {Rule Minor [Search results]}', 'jetpack' ); ?&gt;
                &lt;select class="conditions-rule-minor" name="conditions[rules_minor][]" &lt;?php if ( ! $rule['major'] ) { ?&gt; disabled="disabled"&lt;?php } ?&gt; data-loading-text="&lt;?php esc_attr_e( 'Loading...', 'jetpack' ); ?&gt;"&gt;
                  &lt;?php self::widget_conditions_options_echo( $rule['major'], $rule['minor'] ); ?&gt;
                &lt;/select&gt;
                &lt;span class="condition-conjunction"&gt;&lt;?php echo esc_html_x( 'or', 'Shown between widget visibility conditions.', 'jetpack' ); ?&gt;&lt;/span&gt;
              &lt;/div&gt;
              &lt;div class="condition-control alignright"&gt;
                &lt;a href="#" class="delete-condition"&gt;&lt;?php esc_html_e( 'Delete', 'jetpack' ); ?&gt;&lt;/a&gt; | &lt;a href="#" class="add-condition"&gt;&lt;?php esc_html_e( 'Add', 'jetpack' ); ?&gt;&lt;/a&gt;
              &lt;/div&gt;
              &lt;br class="clear" /&gt;
            &lt;/div&gt;&lt;!-- .condition --&gt;
            &lt;?php
          }

          ?&gt;
        &lt;/div&gt;&lt;!-- .conditions --&gt;
      &lt;/div&gt;&lt;!-- .widget-conditional-inner --&gt;
    &lt;/div&gt;&lt;!-- .widget-conditional --&gt;
    &lt;?php
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p> On an AJAX update of the widget settings, process the display conditions.</p>
<p> @param array $new_instance New settings for this instance as input by the user.
 @param array $old_instance Old settings for this instance.
 @return array Modified settings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">widget_update</span><span class="hljs-params">( <span class="hljs-variable">$instance</span>, <span class="hljs-variable">$new_instance</span>, <span class="hljs-variable">$old_instance</span> )</span>
  </span>{
    <span class="hljs-variable">$conditions</span> = <span class="hljs-keyword">array</span>();
    <span class="hljs-variable">$conditions</span>[<span class="hljs-string">'action'</span>] = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'conditions'</span>][<span class="hljs-string">'action'</span>];
    <span class="hljs-variable">$conditions</span>[<span class="hljs-string">'rules'</span>] = <span class="hljs-keyword">array</span>();

    <span class="hljs-keyword">foreach</span> ( <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'conditions'</span>][<span class="hljs-string">'rules_major'</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$index</span> =&gt; <span class="hljs-variable">$major_rule</span> ) {
      <span class="hljs-keyword">if</span> ( ! <span class="hljs-variable">$major_rule</span> )
        <span class="hljs-keyword">continue</span>;

      <span class="hljs-variable">$conditions</span>[<span class="hljs-string">'rules'</span>][] = <span class="hljs-keyword">array</span>(
        <span class="hljs-string">'major'</span> =&gt; <span class="hljs-variable">$major_rule</span>,
        <span class="hljs-string">'minor'</span> =&gt; <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'conditions'</span>][<span class="hljs-string">'rules_minor'</span>][<span class="hljs-variable">$index</span>] ) ? <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'conditions'</span>][<span class="hljs-string">'rules_minor'</span>][<span class="hljs-variable">$index</span>] : <span class="hljs-string">''</span>
      );
    }

    <span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">empty</span>( <span class="hljs-variable">$conditions</span>[<span class="hljs-string">'rules'</span>] ) )
      <span class="hljs-variable">$instance</span>[<span class="hljs-string">'conditions'</span>] = <span class="hljs-variable">$conditions</span>;
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">unset</span>( <span class="hljs-variable">$instance</span>[<span class="hljs-string">'conditions'</span>] );

    <span class="hljs-keyword">if</span> (
        ( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$instance</span>[<span class="hljs-string">'conditions'</span>] ) &amp;&amp; ! <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$old_instance</span>[<span class="hljs-string">'conditions'</span>] ) )
        ||
        (
          <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$instance</span>[<span class="hljs-string">'conditions'</span>], <span class="hljs-variable">$old_instance</span>[<span class="hljs-string">'conditions'</span>] )
          &amp;&amp;
          serialize( <span class="hljs-variable">$instance</span>[<span class="hljs-string">'conditions'</span>] ) != serialize( <span class="hljs-variable">$old_instance</span>[<span class="hljs-string">'conditions'</span>] )
        )
      ) {
      do_action( <span class="hljs-string">'widget_conditions_save'</span> );
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$instance</span>[<span class="hljs-string">'conditions'</span>] ) &amp;&amp; <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$old_instance</span>[<span class="hljs-string">'conditions'</span>] ) ) {
      do_action( <span class="hljs-string">'widget_conditions_delete'</span> );
    }

    <span class="hljs-keyword">return</span> <span class="hljs-variable">$instance</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p> Filter the list of widgets for a sidebar so that active sidebars work as expected.</p>
<p> @param array $widget_areas An array of widget areas and their widgets.
 @return array The modified $widget_area array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sidebars_widgets</span><span class="hljs-params">( <span class="hljs-variable">$widget_areas</span> )</span>
  </span>{
    <span class="hljs-variable">$settings</span> = <span class="hljs-keyword">array</span>();

    <span class="hljs-keyword">foreach</span> ( <span class="hljs-variable">$widget_areas</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$widget_area</span> =&gt; <span class="hljs-variable">$widgets</span> ) {
      <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">empty</span>( <span class="hljs-variable">$widgets</span> ) )
        <span class="hljs-keyword">continue</span>;

      <span class="hljs-keyword">if</span> ( <span class="hljs-string">'wp_inactive_widgets'</span> == <span class="hljs-variable">$widget_area</span> )
        <span class="hljs-keyword">continue</span>;

      <span class="hljs-keyword">foreach</span> ( <span class="hljs-variable">$widgets</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$position</span> =&gt; <span class="hljs-variable">$widget_id</span> ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Find the conditions for this widget.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ( preg_match( <span class="hljs-string">'/^(.+?)-(\d+)$/'</span>, <span class="hljs-variable">$widget_id</span>, <span class="hljs-variable">$matches</span> ) ) {
          <span class="hljs-variable">$id_base</span> = <span class="hljs-variable">$matches</span>[<span class="hljs-number">1</span>];
          <span class="hljs-variable">$widget_number</span> = intval( <span class="hljs-variable">$matches</span>[<span class="hljs-number">2</span>] );
        }
        <span class="hljs-keyword">else</span> {
          <span class="hljs-variable">$id_base</span> = <span class="hljs-variable">$widget_id</span>;
          <span class="hljs-variable">$widget_number</span> = <span class="hljs-keyword">null</span>;
        }

        <span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$settings</span>[<span class="hljs-variable">$id_base</span>] ) ) {
          <span class="hljs-variable">$settings</span>[<span class="hljs-variable">$id_base</span>] = get_option( <span class="hljs-string">'widget_'</span> . <span class="hljs-variable">$id_base</span> );
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>New multi widget (WP_Widget)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ( ! is_null( <span class="hljs-variable">$widget_number</span> ) ) {
          <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$settings</span>[<span class="hljs-variable">$id_base</span>][<span class="hljs-variable">$widget_number</span>] ) &amp;&amp; <span class="hljs-keyword">false</span> === <span class="hljs-keyword">self</span>::filter_widget( <span class="hljs-variable">$settings</span>[<span class="hljs-variable">$id_base</span>][<span class="hljs-variable">$widget_number</span>] ) ) {
            <span class="hljs-keyword">unset</span>( <span class="hljs-variable">$widget_areas</span>[<span class="hljs-variable">$widget_area</span>][<span class="hljs-variable">$position</span>] );
          }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Old single widget</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">empty</span>( <span class="hljs-variable">$settings</span>[ <span class="hljs-variable">$id_base</span> ] ) &amp;&amp; <span class="hljs-keyword">false</span> === <span class="hljs-keyword">self</span>::filter_widget( <span class="hljs-variable">$settings</span>[<span class="hljs-variable">$id_base</span>] ) ) {
          <span class="hljs-keyword">unset</span>( <span class="hljs-variable">$widget_areas</span>[<span class="hljs-variable">$widget_area</span>][<span class="hljs-variable">$position</span>] );
        }
      }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-variable">$widget_areas</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p> Determine whether the widget should be displayed based on conditions set by the user.</p>
<p> @param array $instance The widget settings.
 @return array Settings to display or bool false to hide.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter_widget</span><span class="hljs-params">( <span class="hljs-variable">$instance</span> )</span>
  </span>{
    <span class="hljs-keyword">global</span> <span class="hljs-variable">$post</span>, <span class="hljs-variable">$wp_query</span>;

    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">empty</span>( <span class="hljs-variable">$instance</span>[<span class="hljs-string">'conditions'</span>] ) || <span class="hljs-keyword">empty</span>( <span class="hljs-variable">$instance</span>[<span class="hljs-string">'conditions'</span>][<span class="hljs-string">'rules'</span>] ) )
      <span class="hljs-keyword">return</span> <span class="hljs-variable">$instance</span>;

    <span class="hljs-variable">$condition_result</span> = <span class="hljs-keyword">false</span>;

    <span class="hljs-keyword">foreach</span> ( <span class="hljs-variable">$instance</span>[<span class="hljs-string">'conditions'</span>][<span class="hljs-string">'rules'</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$rule</span> ) {
      <span class="hljs-keyword">switch</span> ( <span class="hljs-variable">$rule</span>[<span class="hljs-string">'major'</span>] ) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'date'</span>:
          <span class="hljs-keyword">switch</span> ( <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] ) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">''</span>:
              <span class="hljs-variable">$condition_result</span> = is_date();
            <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'month'</span>:
              <span class="hljs-variable">$condition_result</span> = is_month();
            <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'day'</span>:
              <span class="hljs-variable">$condition_result</span> = is_day();
            <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'year'</span>:
              <span class="hljs-variable">$condition_result</span> = is_year();
            <span class="hljs-keyword">break</span>;
          }
        <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'page'</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Previously hardcoded post type options.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> ( <span class="hljs-string">'post'</span> == <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] )
            <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] = <span class="hljs-string">'post_type-post'</span>;
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( ! <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] )
            <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] = <span class="hljs-string">'post_type-page'</span>;

          <span class="hljs-keyword">switch</span> ( <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] ) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'404'</span>:
              <span class="hljs-variable">$condition_result</span> = is_404();
            <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'search'</span>:
              <span class="hljs-variable">$condition_result</span> = is_search();
            <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'archive'</span>:
              <span class="hljs-variable">$condition_result</span> = is_archive();
            <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'posts'</span>:
              <span class="hljs-variable">$condition_result</span> = <span class="hljs-variable">$wp_query</span><span class="hljs-variable">-&gt;is_posts_page</span>;
            <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'home'</span>:
              <span class="hljs-variable">$condition_result</span> = is_home();
            <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'front'</span>:
              <span class="hljs-keyword">if</span> ( current_theme_supports( <span class="hljs-string">'infinite-scroll'</span> ) )
                <span class="hljs-variable">$condition_result</span> = is_front_page();
              <span class="hljs-keyword">else</span> {
                <span class="hljs-variable">$condition_result</span> = is_front_page() &amp;&amp; !is_paged();
              }
            <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
              <span class="hljs-keyword">if</span> ( substr( <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>], <span class="hljs-number">0</span>, <span class="hljs-number">10</span> ) == <span class="hljs-string">'post_type-'</span> )
                <span class="hljs-variable">$condition_result</span> = is_singular( substr( <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>], <span class="hljs-number">10</span> ) );
              <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>$rule[‘minor’] is a page ID</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-variable">$condition_result</span> = is_page( <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] );
              }
            <span class="hljs-keyword">break</span>;
          }
        <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'tag'</span>:
          <span class="hljs-keyword">if</span> ( ! <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] &amp;&amp; is_tag() )
            <span class="hljs-variable">$condition_result</span> = <span class="hljs-keyword">true</span>;
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( is_singular() &amp;&amp; <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] &amp;&amp; has_tag( <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] ) )
            <span class="hljs-variable">$condition_result</span> = <span class="hljs-keyword">true</span>;
          <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$tag</span> = get_tag( <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] );

            <span class="hljs-keyword">if</span> ( <span class="hljs-variable">$tag</span> &amp;&amp; is_tag( <span class="hljs-variable">$tag</span><span class="hljs-variable">-&gt;slug</span> ) )
              <span class="hljs-variable">$condition_result</span> = <span class="hljs-keyword">true</span>;
          }
        <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'category'</span>:
          <span class="hljs-keyword">if</span> ( ! <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] &amp;&amp; is_category() )
            <span class="hljs-variable">$condition_result</span> = <span class="hljs-keyword">true</span>;
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( is_category( <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] ) )
            <span class="hljs-variable">$condition_result</span> = <span class="hljs-keyword">true</span>;
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( is_singular() &amp;&amp; <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] &amp;&amp; in_array( <span class="hljs-string">'category'</span>, get_post_taxonomies() ) &amp;&amp;  has_category( <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] ) )
            <span class="hljs-variable">$condition_result</span> = <span class="hljs-keyword">true</span>;
        <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'author'</span>:
          <span class="hljs-keyword">if</span> ( ! <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] &amp;&amp; is_author() )
            <span class="hljs-variable">$condition_result</span> = <span class="hljs-keyword">true</span>;
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] &amp;&amp; is_author( <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] ) )
            <span class="hljs-variable">$condition_result</span> = <span class="hljs-keyword">true</span>;
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( is_singular() &amp;&amp; <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] &amp;&amp; <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] == <span class="hljs-variable">$post</span><span class="hljs-variable">-&gt;post_author</span> )
            <span class="hljs-variable">$condition_result</span> = <span class="hljs-keyword">true</span>;
        <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'taxonomy'</span>:
          <span class="hljs-variable">$term</span> = explode( <span class="hljs-string">'_tax_'</span>, <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] ); <span class="hljs-comment">// $term[0] = taxonomy name; $term[1] = term id</span>
          <span class="hljs-variable">$terms</span> = get_the_terms( <span class="hljs-variable">$post</span><span class="hljs-variable">-&gt;ID</span>, <span class="hljs-variable">$rule</span>[<span class="hljs-string">'minor'</span>] ); <span class="hljs-comment">// Does post have terms in taxonomy?</span>
          <span class="hljs-keyword">if</span> ( is_tax( <span class="hljs-variable">$term</span>[<span class="hljs-number">0</span>], <span class="hljs-variable">$term</span>[<span class="hljs-number">1</span>] ) )
            <span class="hljs-variable">$condition_result</span> = <span class="hljs-keyword">true</span>;
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( is_singular() &amp;&amp; <span class="hljs-variable">$term</span>[<span class="hljs-number">1</span>] &amp;&amp; has_term( <span class="hljs-variable">$term</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">$term</span>[<span class="hljs-number">0</span>] ) )
            <span class="hljs-variable">$condition_result</span> = <span class="hljs-keyword">true</span>;
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( is_singular() &amp;&amp; <span class="hljs-variable">$terms</span> &amp; !is_wp_error( <span class="hljs-variable">$terms</span> ) )
            <span class="hljs-variable">$condition_result</span> = <span class="hljs-keyword">true</span>;
        <span class="hljs-keyword">break</span>;
      }

      <span class="hljs-keyword">if</span> ( <span class="hljs-variable">$condition_result</span> )
        <span class="hljs-keyword">break</span>;
    }

    <span class="hljs-keyword">if</span> ( ( <span class="hljs-string">'show'</span> == <span class="hljs-variable">$instance</span>[<span class="hljs-string">'conditions'</span>][<span class="hljs-string">'action'</span>] &amp;&amp; ! <span class="hljs-variable">$condition_result</span> ) || ( <span class="hljs-string">'hide'</span> == <span class="hljs-variable">$instance</span>[<span class="hljs-string">'conditions'</span>][<span class="hljs-string">'action'</span>] &amp;&amp; <span class="hljs-variable">$condition_result</span> ) )
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-variable">$instance</span>;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">strcasecmp_name</span><span class="hljs-params">( <span class="hljs-variable">$a</span>, <span class="hljs-variable">$b</span> )</span>
  </span>{
    <span class="hljs-keyword">return</span> strcasecmp( <span class="hljs-variable">$a</span><span class="hljs-variable">-&gt;name</span>, <span class="hljs-variable">$b</span><span class="hljs-variable">-&gt;name</span> );
  }
}

<span class="hljs-keyword">new</span> UW_Widget_Conditions;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
